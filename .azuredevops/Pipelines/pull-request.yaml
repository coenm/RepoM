# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core
# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/expressions?view=azure-devops#variables
# https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=yaml%2Cbatch#share-variables-across-pipelines
# https://docs.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&tabs=yaml

trigger: none

pr:
  - main
  - release/*
  - feature/*

pool:
  vmImage: 'windows-latest'

stages:
  - stage: "Build"
    displayName: "Artifact build"
    jobs:
      - job: "Build"
        displayName: "Artifact build"
        variables:
          - name: DOTNET_CLI_TELEMETRY_OPTOUT
            value: 1
          - name: DOTNET_SKIP_FIRST_TIME_EXPERIENCE
            value: 1
          - name: BuildConfiguration
            value: Release
          - name: ci_feed
            value: 39ce9363-a308-4580-8610-ee11f4953539/01001223-8651-4b73-a7ca-ba27c3e10a3c
 
        steps:
        - task: UseDotNet@2
          displayName: "Use dotnet sdk 7.0.x"
          inputs:
            version: 7.0.x
            includePreviewVersions: false

        - script: dotnet --info
          displayName: Show dotnet SDK info
      
        - task: NuGetToolInstaller@1
          displayName: Install Nuget 5x
          inputs:
            versionSpec: '5.*'
            checkLatest: true

        - task: DotNetCoreCLI@2
          displayName: DotNet Restore
          inputs:
            command: 'restore'
            projects: '**/*.csproj'

        - task: DotNetCoreCLI@2
          displayName: "DotNet Build"
          inputs:
            command: 'build'
            projects: '**/*.sln'
            configuration: $(BuildConfiguration) 

        - task: DotNetCoreCLI@2
          displayName: "DotNet Test"
          inputs:
            command: test
            projects: '**/*[Tt]ests/*.csproj'
            configuration: $(BuildConfiguration) 
            nobuild: true          